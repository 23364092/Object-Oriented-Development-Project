import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

/**
 * The {@code CSVReaderEmployee} class is responsible for reading employee data
 * from a CSV file and populating the {@link PayrollSystem} with employee objects.
 */
public class CSVReaderEmployee {
    private final String filePath = "src/Employees.csv";

    /**
     * Constructs a {@code CSVReaderEmployee} object to handle CSV file operations.
     */
    public CSVReaderEmployee() {
    }

    /**
     * Reads employee data from the CSV file, processes it, and populates the given {@link PayrollSystem}.
     *
     * @param payrollSystem the {@link PayrollSystem} object to populate with employee data
     */
    public void readEmployeesFromCSV(PayrollSystem payrollSystem) {
        try (BufferedReader br = new BufferedReader(new FileReader(filePath))) {
            String line = br.readLine(); // Skip the header line

            // Iterates through each line in the CSV file
            while ((line = br.readLine()) != null) {
                String[] data = line.split(",");
                
                // Skips lines with insufficient data
                if (data.length != 8) {
                    continue;
                }

                try {
                    // Extract and trim data from the CSV line
                    String employeeId = data[0].trim();
                    String name = data[1].trim();
                    String position = data[2].trim();
                    String dateOfEmployment = data[4].trim();
                    String contractType = data[5].trim().toUpperCase();
                    String promotion = data[6].trim().toUpperCase();
                    int topCounter = Integer.parseInt(data[7].trim());

                    // Processes full-time employees
                    if (contractType.equals("FULLTIME")) {
                        int salaryScale = Integer.parseInt(data[3].trim());
                        payrollSystem.addEmployee(new FullTimeEmployee(
                                employeeId, name, position, salaryScale, dateOfEmployment, contractType, promotion, topCounter));
                    } 
                    // Processes part-time employees
                    else if (contractType.equals("PARTTIME")) {
                        double hourlyRate = Double.parseDouble(data[3].trim());
                        payrollSystem.addEmployee(new PartTimeEmployee(
                                employeeId, name, position, hourlyRate, dateOfEmployment, contractType
                        ));
                    }
                } catch (NumberFormatException e) {
                    // Logs an error message if numeric parsing fails
                    System.err.println("Error parsing number for line: " + line);
                }
            }

            // Populates payslips for all employees
            payrollSystem.populatePayslips();

        } catch (IOException e) {
            // Logs an error message if the file cannot be read
            System.err.println("Error reading the CSV file: " + e.getMessage());
        }
    }
}
